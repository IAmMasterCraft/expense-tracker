<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' https://accounts.google.com/gsi/client; style-src 'self' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; img-src 'self' data: https://images.pexels.com https://images.unsplash.com; connect-src 'self' https://sheets.googleapis.com https://accounts.google.com; frame-src https://accounts.google.com;"
    />
    <title>Annual Expense Tracker</title>
    <link rel="icon" type="image/svg+xml" href="/brand/logo-mark.svg" />
    <link rel="apple-touch-icon" href="/brand/logo-mark.svg" />
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <div class="splash" id="splash">
      <div class="splash-card">
        <div class="splash-photo" role="img" aria-label="Cozy coffee and pastry"></div>
        <div class="splash-content">
          <img class="brand-lockup" src="/brand/logo-lockup.svg" alt="Expense Tracker logo" />
          <p class="eyebrow">Welcome</p>
          <h1>Expense Whisper</h1>
          <p class="subhead">A warm, local ledger for mindful spending.</p>
          <button type="button" class="splash-button" id="enterApp">Enter</button>
        </div>
      </div>
    </div>

    <div class="app-shell">
      <div class="device">
        <div class="month-float">
          <button type="button" id="helpTrigger" class="help-trigger" aria-label="Help and walkthrough">?</button>
          <select id="currencySelect" aria-label="Select currency"></select>
          <select id="monthSelect" aria-label="Select month"></select>
        </div>

        <main class="page">
          <section
            class="tab-panel active"
            data-tab-panel="expenses"
            id="panel-expenses"
            role="tabpanel"
            aria-labelledby="tab-expenses"
            tabindex="0"
          >
            <section class="card card--media">
              <div class="media-panel media-panel--expenses" role="img" aria-label="Notebook and coffee"></div>
            </section>

            <section class="card hero-card">
              <p class="eyebrow">Today‚Äôs Focus</p>
              <h2 id="dailyPrompt">Make room for what tastes good.</h2>
              <p class="hint">Capture your income and expenses in seconds.</p>
            </section>

            <section class="card">
              <div class="card-header">
                <h2>Expenses</h2>
              </div>
              <form id="expenseForm" class="expense-form">
                <label class="field field--wide" for="expenseName">
                  <span class="field-label">Expense Name</span>
                  <input
                    id="expenseName"
                    type="text"
                    placeholder="Expense name"
                    maxlength="120"
                    required
                  />
                </label>
                <label class="field field--amount" for="expenseAmount">
                  <span class="field-label">Amount</span>
                  <input
                    id="expenseAmount"
                    type="number"
                    min="0"
                    step="0.01"
                    placeholder="Amount"
                    required
                  />
                </label>
                <label class="field field--wide" for="expenseCategory">
                  <span class="field-label">Category</span>
                  <select id="expenseCategory" aria-label="Expense category"></select>
                </label>
                <label class="checkbox">
                  <input id="expenseCompleted" type="checkbox" />
                  Completed
                </label>
                <button type="submit">Add</button>
                <button type="button" class="icon-button" id="expenseDictate" aria-label="Dictate expense">
                  üéôÔ∏è
                </button>
                <button type="button" class="ghost-button" id="expenseGuided">Guided</button>
              </form>
              <p class="hint" id="expenseDictationStatus"></p>
              <div class="suggestions" id="expenseSuggestions"></div>
            </section>

            <section class="card">
              <h2>Recent Expenses</h2>
              <div class="expense-list" id="expenseList"></div>
            </section>
          </section>

          <section
            class="tab-panel"
            data-tab-panel="home"
            id="panel-home"
            role="tabpanel"
            aria-labelledby="tab-home"
            tabindex="0"
            hidden
          >
            <section class="card card--media">
              <div class="media-panel media-panel--home" role="img" aria-label="Warm pastry and coffee"></div>
            </section>

            <section class="card card--highlight">
              <h2>Income</h2>
              <form id="incomeForm" class="inline-form">
                <label class="field field--wide" for="incomeAmount">
                  <span class="field-label">Income Amount</span>
                  <input
                    id="incomeAmount"
                    type="number"
                    min="0"
                    step="0.01"
                    placeholder="0.00"
                    aria-label="Income amount"
                  />
                </label>
                <button type="submit">Save</button>
                <button type="button" class="icon-button" id="incomeDictate" aria-label="Dictate income">
                  üéôÔ∏è
                </button>
                <button type="button" class="ghost-button" id="incomeGuided">Guided</button>
              </form>
              <p class="hint" id="incomeDictationStatus"></p>
              <div class="suggestions" id="incomeSuggestions"></div>
            </section>

            <section class="card">
              <h2>Month Summary</h2>
              <div class="summary">
                <div>
                  <span>Total Income</span>
                  <strong id="monthIncome">$0.00</strong>
                </div>
                <div>
                  <span>Total Expenses</span>
                  <strong id="monthTotal">$0.00</strong>
                </div>
                <div>
                  <span>Balance</span>
                  <strong id="monthBalance">$0.00</strong>
                </div>
              </div>
            </section>

            <section class="card">
              <h2>Year Snapshot</h2>
              <div class="summary">
                <div>
                  <span>Yearly Income</span>
                  <strong id="yearIncome">$0.00</strong>
                </div>
                <div>
                  <span>Yearly Expenses</span>
                  <strong id="yearExpense">$0.00</strong>
                </div>
                <div>
                  <span>Yearly Balance</span>
                  <strong id="yearBalance">$0.00</strong>
                </div>
              </div>
            </section>
          </section>

          <section
            class="tab-panel"
            data-tab-panel="analysis"
            id="panel-analysis"
            role="tabpanel"
            aria-labelledby="tab-analysis"
            tabindex="0"
            hidden
          >
            <section class="card card--media">
              <div class="media-panel media-panel--analysis" role="img" aria-label="Minimal notebook flat lay"></div>
            </section>
            <section class="card">
              <h2>Analysis</h2>
              <div class="analysis-switch" role="tablist" aria-label="Analysis mode">
                <button type="button" class="analysis-mode active" id="analysisScopeMonthBtn" data-analysis-scope="month">Month Analysis</button>
                <button type="button" class="analysis-mode" id="analysisScopeYearBtn" data-analysis-scope="year">Year Analysis</button>
              </div>
              <div class="analysis-charts">
                <div class="chart-wrap">
                  <canvas id="analysisChart" aria-label="Analysis trend chart" role="img"></canvas>
                </div>
                <div class="chart-wrap">
                  <canvas id="analysisPieChart" aria-label="Expense category distribution chart" role="img"></canvas>
                </div>
              </div>
              <div class="analysis-list" id="analysisList"></div>
              <p class="hint" id="analysisNote"></p>
            </section>
          </section>

          <section
            class="tab-panel"
            data-tab-panel="backup"
            id="panel-backup"
            role="tabpanel"
            aria-labelledby="tab-backup"
            tabindex="0"
            hidden
          >
            <section class="card card--media">
              <div class="media-panel media-panel--backup" role="img" aria-label="Warm desk scene"></div>
            </section>
            <section class="card">
              <h2>Import / Export</h2>
              <p class="hint">
                Export CSV for backups or import CSV files that follow the template.
              </p>
              <div class="backup-actions">
                <button type="button" id="exportExpenses">Export Expenses CSV</button>
                <button type="button" id="exportIncome">Export Income CSV</button>
                <a class="action-link" href="/templates/expenses-template.csv" download>Download Expenses Template</a>
                <a class="action-link" href="/templates/income-template.csv" download>Download Income Template</a>
              </div>
              <form id="importForm" class="backup-form">
                <label class="field field--wide" for="importExpenses">
                  <span class="field-label">Expenses CSV File</span>
                  <input id="importExpenses" type="file" accept=".csv" />
                </label>
                <button type="button" id="importExpensesBtn">Import Expenses CSV</button>
                <label class="field field--wide" for="importIncome">
                  <span class="field-label">Income CSV File</span>
                  <input id="importIncome" type="file" accept=".csv" />
                </label>
                <button type="button" id="importIncomeBtn">Import Income CSV</button>
              </form>
            </section>

            <section class="card">
              <h2>Google Sheets Backup</h2>
              <p class="hint">
                Data stays on this device in IndexedDB. Use this section to back up
                or restore from a Google Sheet you own.
              </p>
              <form id="backupForm" class="backup-form">
                <label class="field field--wide" for="googleClientId">
                  <span class="field-label">Google OAuth Client ID</span>
                  <input
                    id="googleClientId"
                    type="text"
                    placeholder="Google OAuth Client ID"
                    autocomplete="off"
                  />
                </label>
                <label class="field field--wide" for="spreadsheetId">
                  <span class="field-label">Spreadsheet ID</span>
                  <input
                    id="spreadsheetId"
                    type="text"
                    placeholder="Spreadsheet ID"
                    autocomplete="off"
                  />
                </label>
                <label class="field field--wide" for="expensesSheet">
                  <span class="field-label">Expenses Sheet Name</span>
                  <input
                    id="expensesSheet"
                    type="text"
                    placeholder="Expenses sheet name (default: Expenses)"
                    autocomplete="off"
                  />
                </label>
                <label class="field field--wide" for="incomeSheet">
                  <span class="field-label">Income Sheet Name</span>
                  <input
                    id="incomeSheet"
                    type="text"
                    placeholder="Income sheet name (default: Income)"
                    autocomplete="off"
                  />
                </label>
                <label class="checkbox">
                  <input id="autoBackup" type="checkbox" />
                  Auto-backup on changes
                </label>
                <div class="backup-actions">
                  <button type="button" id="connectGoogle">Connect Google</button>
                  <button type="button" id="restoreGoogle">Restore</button>
                  <button type="submit">Backup Now</button>
                </div>
              </form>
            </section>
          </section>
        </main>

        <div class="toast-host" id="toastHost" aria-live="polite" aria-atomic="true"></div>
        <div class="tour-overlay hidden" id="tourOverlay" aria-live="polite">
          <div class="tour-card">
            <p class="eyebrow" id="tourStepLabel">Step 1</p>
            <h2 id="tourTitle">Welcome</h2>
            <p class="hint" id="tourBody">This short guide shows how to use the app.</p>
            <div class="tour-actions">
              <button type="button" class="ghost-button" id="tourPrev">Back</button>
              <button type="button" class="ghost-button" id="tourSkip">Skip</button>
              <button type="button" id="tourNext">Next</button>
            </div>
          </div>
        </div>

        <nav class="tabbar" aria-label="Primary" role="tablist">
          <button
            type="button"
            class="tab active"
            data-tab="expenses"
            id="tab-expenses"
            role="tab"
            aria-controls="panel-expenses"
            aria-selected="true"
            tabindex="0"
          >
            Expenses
          </button>
          <button
            type="button"
            class="tab"
            data-tab="home"
            id="tab-home"
            role="tab"
            aria-controls="panel-home"
            aria-selected="false"
            tabindex="-1"
          >
            Income
          </button>
          <button
            type="button"
            class="tab"
            data-tab="analysis"
            id="tab-analysis"
            role="tab"
            aria-controls="panel-analysis"
            aria-selected="false"
            tabindex="-1"
          >
            Analysis
          </button>
          <button
            type="button"
            class="tab"
            data-tab="backup"
            id="tab-backup"
            role="tab"
            aria-controls="panel-backup"
            aria-selected="false"
            tabindex="-1"
          >
            Backup
          </button>
        </nav>
      </div>
    </div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="/app.js"></script>
  </body>
</html>
